<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Alihocam Paragrafmatik V6.2 - Mobil Uyumlu</title>
    
    <!-- React ve ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');
        body { font-family: 'Nunito', sans-serif; touch-action: manipulation; -webkit-font-smoothing: antialiased; }
        .animate-spin-slow { animation: spin 12s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .no-tap-highlight { -webkit-tap-highlight-color: transparent; outline: none; }
        /* Mobil için daha belirgin basma efekti */
        .btn-touch:active { transform: scale(0.96); filter: brightness(90%); transition: all 0.1s; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 select-none overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 1. İÇERİK MOTORU ---
        const DATA_POOL = {
            names: ["Ali", "Ayşe", "Mehmet", "Zeynep", "Can", "Ela", "Efe", "Selin", "Mert", "Derya", "Kerem", "İpek"],
            friends: ["Cem", "Ada", "Kaan", "Naz", "Ozan", "İnci", "Barış", "Pelin"],
            animals: [
                { name: "kedi", sound: "mırıldandı", action: "süt içti", food: "mama", icon: "fa-cat" },
                { name: "köpek", sound: "havladı", action: "topu yakaladı", food: "kemik", icon: "fa-dog" },
                { name: "kuş", sound: "cıvıldadı", action: "uçtu", food: "yem", icon: "fa-dove" },
                { name: "tavşan", sound: "zıpladı", action: "havuç yedi", food: "havuç", icon: "fa-carrot" }
            ],
            places: ["parka", "okula", "bahçeye", "markete", "kütüphaneye", "sahile", "ormana"],
            objects: ["top", "kitap", "kalem", "elma", "balon", "oyuncak", "uçurtma"],
            adjectives: ["mutlu", "üzgün", "heyecanlı", "yorgun", "neşeli", "hızlı"],
            colors: ["kırmızı", "mavi", "yeşil", "sarı", "mor", "turuncu"],
            science_topics: [
                { topic: "Güneş", fact: "ısı kaynağıdır", detail: "bir yıldızdır", icon: "fa-sun" },
                { topic: "Ay", fact: "Dünya'nın uydusudur", detail: "ışık kaynağı değildir", icon: "fa-moon" },
                { topic: "Su", fact: "hayat kaynağıdır", detail: "döngüseldir", icon: "fa-water" },
                { topic: "Ağaç", fact: "oksijen üretir", detail: "kökleri vardır", icon: "fa-tree" }
            ]
        };

        const rnd = (arr) => arr[Math.floor(Math.random() * arr.length)];

        // Dinamik Hikaye Oluşturucu
        const generateLevelContent = (grade, difficulty, count = 20) => {
            const stories = [];
            for (let i = 0; i < count; i++) {
                let story = {};
                const name1 = rnd(DATA_POOL.names);
                const name2 = rnd(DATA_POOL.friends);
                const animal = rnd(DATA_POOL.animals);
                const place = rnd(DATA_POOL.places);
                const object = rnd(DATA_POOL.objects);
                const color = rnd(DATA_POOL.colors);
                const adj = rnd(DATA_POOL.adjectives);
                const numOptions = grade === 4 ? 4 : 3;

                if (grade === 1) {
                    const templates = [
                        {
                            type: "meet",
                            text: `${name1} ${place} gitti. Orada arkadaşı ${name2}'i gördü. ${name2}'in elinde ${color} bir ${object} vardı.`,
                            q: [
                                { t: "mc", q: `${name1} nereye gitti?`, a: place, o: [place, "eve", "uzaya"] },
                                { t: "mc", q: `${name1} kimi gördü?`, a: name2, o: [name2, "Ali'yi", "kediyi"] },
                                { t: "mc", q: `${object} ne renkti?`, a: color, o: [color, "siyah", "beyaz"] },
                                { t: "match", p: [{q: "Giden", a: name1}, {q: "Görülen", a: name2}] },
                                { t: "match", p: [{q: "Nesne", a: object}, {q: "Renk", a: color}] },
                                { t: "dnd", q: `${name1} _____ gitti.`, a: place, o: [place, "uykuya", "eve"] },
                                { t: "dnd", q: `${name2}'in elinde _____ vardı.`, a: object, o: [object, "kuş", "taş"] }
                            ],
                            icon: "fa-child"
                        },
                        {
                            type: "animal",
                            text: `Minik ${animal.name} çok acıkmıştı. Mutfağa gitti. Orada ${animal.food} buldu. Karnı doyunca ${animal.sound}.`,
                            q: [
                                { t: "mc", q: "Hayvan neydi?", a: animal.name, o: [animal.name, "fil", "aslan"] },
                                { t: "mc", q: "Ne buldu?", a: animal.food, o: [animal.food, "taş", "su"] },
                                { t: "mc", q: "Doyunca ne yaptı?", a: animal.sound, o: [animal.sound, "ağladı", "kaçtı"] },
                                { t: "match", p: [{q: "Hayvan", a: animal.name}, {q: "Yiyecek", a: animal.food}] },
                                { t: "match", p: [{q: "Önce", a: "Acıktı"}, {q: "Sonra", a: "Doydu"}] },
                                { t: "dnd", q: `Minik ${animal.name} _____ gitti.`, a: "mutfağa", o: ["mutfağa", "okula", "parka"] },
                                { t: "dnd", q: `Karnı doyunca _____.`, a: animal.sound, o: [animal.sound, "sustu", "uyudu"] }
                            ],
                            icon: animal.icon
                        }
                    ];
                    story = rnd(templates);
                } else if (grade === 2) {
                    const templates = [
                        {
                            text: `${name1} ve ${name2} ${place} buluştular. ${name1} çok ${adj} görünüyordu. Çünkü en sevdiği ${object} kaybolmuştu. ${name2} ona yardım etti ve birlikte aradılar.`,
                            q: [
                                { t: "mc", q: "Kimler buluştu?", a: `${name1} ve ${name2}`, o: [`${name1} ve ${name2}`, "Ali ve Veli", "Kedi ve Köpek"] },
                                { t: "mc", q: `${name1} nasıl görünüyordu?`, a: adj, o: [adj, "kızgın", "korkmuş"] },
                                { t: "mc", q: "Ne kaybolmuştu?", a: object, o: [object, "para", "çanta"] },
                                { t: "match", p: [{q: "Kaybolan", a: object}, {q: "Duygu", a: adj}] },
                                { t: "match", p: [{q: "Yardım eden", a: name2}, {q: "Üzülen", a: name1}] },
                                { t: "dnd", q: `${name1} çok _____ görünüyordu.`, a: adj, o: [adj, "mutlu", "sakin"] },
                                { t: "dnd", q: `Birlikte _____ aradılar.`, a: object, o: [object, "yolu", "evi"] }
                            ],
                            icon: "fa-user-group"
                        }
                    ];
                    story = rnd(templates);
                } else if (grade === 3) {
                    const templates = [
                        {
                            text: `Bir gün ${name1}, ${place} yürürken konuşan bir ${animal.name} gördü. ${animal.name} ona "Bana ${animal.food} verirsen sana bir sır veririm" dedi. ${name1} şaşkınlıkla ${animal.food} verdi.`,
                            q: [
                                { t: "mc", q: `${name1} ne gördü?`, a: `Konuşan ${animal.name}`, o: [`Konuşan ${animal.name}`, "Uçan fil", "Koşan ağaç"] },
                                { t: "mc", q: "Hayvan ne istedi?", a: animal.food, o: [animal.food, "Para", "Su"] },
                                { t: "mc", q: `${name1} ne hissetti?`, a: "Şaşkınlık", o: ["Şaşkınlık", "Korku", "Öfke"] },
                                { t: "match", p: [{q: "Görülen", a: animal.name}, {q: "İstenen", a: animal.food}] },
                                { t: "match", p: [{q: "Yer", a: place}, {q: "Olay", a: "Konuşma"}] },
                                { t: "dnd", q: `${animal.name} ona _____ dedi.`, a: "sır veririm", o: ["sır veririm", "git buradan", "oynayalım"] },
                                { t: "dnd", q: `${name1} şaşkınlıkla _____ verdi.`, a: animal.food, o: [animal.food, "taş", "çiçek"] }
                            ],
                            icon: "fa-wand-magic-sparkles"
                        }
                    ];
                    story = rnd(templates);
                } else {
                    const topic = rnd(DATA_POOL.science_topics);
                    const templates = [
                        {
                            text: `${topic.topic} bizim için çok önemlidir. Bilim insanları ${topic.topic}'in ${topic.fact} olduğunu söyler. Ayrıca ${topic.detail}. ${name1} fen dersinde bunu öğrendiğinde çok şaşırdı.`,
                            q: [
                                { t: "mc", q: "Metnin konusu nedir?", a: topic.topic, o: [topic.topic, "Mars", "Okul", "Yemek"] },
                                { t: "mc", q: `${topic.topic} nedir?`, a: topic.fact, o: [topic.fact, "bir oyuncaktır", "bir yemektir", "bir renktir"] },
                                { t: "mc", q: "Kim şaşırdı?", a: name1, o: [name1, "Öğretmen", "Doktor", "Kimse"] },
                                { t: "match", p: [{q: "Konu", a: topic.topic}, {q: "Özellik", a: topic.fact}] },
                                { t: "match", p: [{q: "Ders", a: "Fen"}, {q: "Öğrenci", a: name1}] },
                                { t: "dnd", q: `${topic.topic} bizim için _____ önemlidir.`, a: "çok", o: ["çok", "az", "hiç", "biraz"] },
                                { t: "dnd", q: `Bilim insanları _____ olduğunu söyler.`, a: topic.fact, o: [topic.fact, "yalan", "oyun", "rüya"] }
                            ],
                            icon: topic.icon
                        }
                    ];
                    story = rnd(templates);
                }

                story.q.forEach(q => {
                    if (q.t === "mc") {
                        while(q.o.length < numOptions) q.o.push("Diğer"); 
                        while(q.o.length > numOptions) q.o.pop();
                        q.o = q.o.sort(() => Math.random() - 0.5);
                    }
                });

                stories.push({
                    id: i,
                    title: `Metin ${i + 1}`,
                    icon: story.icon || "fa-book",
                    content: story.text,
                    questions: story.q
                });
            }
            return stories;
        };

        const GLOBAL_DICTIONARY = {
            "ve": "Bağlaç.", "bir": "Sayı.", "ile": "Birlikte.", "çok": "Fazla.", "az": "Eksik.",
            "gitti": "Ayrıldı.", "geldi": "Ulaştı.", "dedi": "Söyledi.", "koştu": "Hızlandı.",
            "oyun": "Eğlence.", "arkadaş": "Dost.", "okul": "Eğitim yeri.", "kırmızı": "Renk.",
            "mavi": "Renk.", "sabah": "Gündüz başı.", "top": "Oyuncak.", "kedi": "Hayvan.",
            "köpek": "Hayvan.", "ağaç": "Bitki.", "su": "Sıvı.", "yemek": "Gıda.",
            "bahçe": "Alan.", "süt": "İçecek.", "bal": "Tatlı.", "ayı": "Hayvan.",
            "elma": "Meyve.", "kalem": "Yazı aracı.", "silgi": "Silme aracı.", "çanta": "Eşya.",
            "öğretmen": "Eğitmen.", "kar": "Yağış.", "kış": "Mevsim.", "güneş": "Yıldız.",
            "parka": "Oyun alanına.", "mutfağa": "Yemek odasına.", "gördü": "Baktı.",
            "buldu": "Keşfetti.", "acıkmıştı": "Yemek istedi.", "mırıldandı": "Ses çıkardı.",
            "uçtu": "Havalandı.", "zıpladı": "Hopladı.", "havuç": "Sebze.", "kemik": "İskelet.",
            "şaşkınlık": "Hayret.", "sır": "Gizli bilgi.", "bilim": "İlim.", "insanları": "Kişiler.",
            "önemlidir": "Değerlidir.", "yıldızdır": "Gök cismidir.", "uydusudur": "Yörüngedeki cisim.",
            "oksijen": "Hava.", "kökleri": "Bitki ayağı.", "mutlu": "Sevinçli.", "üzgün": "Kederli.",
            "heyecanlı": "Coşkulu.", "yorgun": "Halsiz.", "neşeli": "Keyifli.", "hızlı": "Süratli.",
            "renkli": "Boyalı.", "büyük": "Kocaman.", "küçük": "Minik.", "güzel": "Hoş.", "çirkin": "Kötü.",
            "market": "Dükkan.", "kütüphane": "Kitap evi.", "sahil": "Deniz kenarı.", "orman": "Ağaçlık.",
            "uçurtma": "Oyuncak.", "oyuncak": "Eğlence aracı.", "balon": "Hava topu.", "sahile": "Kumsala.",
            "okula": "Eğitim binasına.", "parka": "Oyun alanına.", "markete": "Alışveriş yerine.", "kütüphaneye": "Kitap yerine."
        };

        const TooltipWord = ({ displayWord, cleanWord }) => {
            const [show, setShow] = useState(false);
            let definition = GLOBAL_DICTIONARY[cleanWord];
            if (!definition) {
                const keys = Object.keys(GLOBAL_DICTIONARY);
                for (let key of keys) {
                    if (cleanWord.startsWith(key) && key.length > 2) {
                        definition = GLOBAL_DICTIONARY[key];
                        break;
                    }
                }
            }
            const hasDefinition = !!definition;

            return (
                <span 
                    className={`relative inline-block mx-0.5 px-1 rounded transition-all duration-200 cursor-pointer text-xl leading-relaxed select-none no-tap-highlight
                        ${hasDefinition 
                        ? 'text-indigo-700 font-bold border-b-2 border-indigo-300 active:bg-indigo-100' 
                        : 'text-gray-700'}`}
                    onClick={(e) => {
                        e.stopPropagation();
                        if (hasDefinition) setShow(!show);
                    }}
                >
                    {displayWord}
                    {show && (
                        <div className="absolute z-50 bottom-full left-1/2 transform -translate-x-1/2 mb-3 w-48 bg-gray-800 text-white text-sm p-3 rounded-xl shadow-xl border border-gray-600 animate-in fade-in zoom-in duration-200">
                            <div className="font-bold text-yellow-400 mb-1 border-b border-gray-600 pb-1"><i className="fa-solid fa-book-open"></i> Sözlük</div>
                            <p>{definition}</p>
                            <div className="absolute -bottom-2 left-1/2 transform -translate-x-1/2 w-3 h-3 bg-gray-800 border-r border-b border-gray-700 rotate-45"></div>
                        </div>
                    )}
                </span>
            );
        };

        // --- İYİLEŞTİRİLMİŞ EŞLEŞTİRME OYUNU ---
        const MatchGame = ({ question, onComplete }) => {
            const [leftItems, setLeftItems] = useState([]);
            const [rightItems, setRightItems] = useState([]);
            const [selectedLeft, setSelectedLeft] = useState(null);
            const [matches, setMatches] = useState({});
            const [wrong, setWrong] = useState(null);

            // Kritik Düzeltme: Soru değiştiğinde state'i sıfırla ve yeni şıkları yükle
            useEffect(() => {
                setLeftItems(question.p.map(p => p.q));
                setRightItems([...question.p.map(p => p.a)].sort(() => Math.random() - 0.5));
                setMatches({});
                setSelectedLeft(null);
                setWrong(null);
            }, [question]);

            const handleLeftClick = (item) => {
                if (matches[item]) return;
                setSelectedLeft(item);
                setWrong(null);
            };

            const handleRightClick = (item) => {
                if (!selectedLeft) return;
                const correctPair = question.p.find(p => p.q === selectedLeft);
                
                if (correctPair.a === item) {
                    const newMatches = { ...matches, [selectedLeft]: item };
                    setMatches(newMatches);
                    setSelectedLeft(null);
                    if (Object.keys(newMatches).length === question.p.length) {
                        setTimeout(() => onComplete(true), 500);
                    }
                } else {
                    setWrong(item);
                    setTimeout(() => setWrong(null), 500);
                }
            };

            return (
                <div className="flex flex-col gap-4 p-4 bg-indigo-50 rounded-2xl border-2 border-indigo-200">
                    <div className="grid grid-cols-2 gap-4">
                        <div className="flex flex-col gap-3">
                            <div className="text-center text-xs font-bold text-indigo-400 uppercase">SOL</div>
                            {leftItems.map((item, idx) => (
                                <button key={`l-${idx}`} onClick={() => handleLeftClick(item)} disabled={matches[item]}
                                    className={`p-3 rounded-xl font-bold shadow-sm text-sm md:text-base relative btn-touch no-tap-highlight
                                    ${matches[item] ? 'bg-green-500 text-white border-green-600' : selectedLeft === item ? 'bg-indigo-600 text-white ring-2 ring-indigo-300' : 'bg-white text-gray-700 border-2 border-gray-200'}`}>
                                    {item}
                                    {matches[item] && <i className="fa-solid fa-check absolute right-2 top-1/2 -translate-y-1/2 text-white"></i>}
                                </button>
                            ))}
                        </div>
                        <div className="flex flex-col gap-3">
                            <div className="text-center text-xs font-bold text-indigo-400 uppercase">SAĞ</div>
                            {rightItems.map((item, idx) => (
                                <button key={`r-${idx}`} onClick={() => handleRightClick(item)} disabled={Object.values(matches).includes(item)}
                                    className={`p-3 rounded-xl font-bold shadow-sm text-sm md:text-base relative btn-touch no-tap-highlight
                                    ${Object.values(matches).includes(item) ? 'bg-green-500 text-white border-green-600' : wrong === item ? 'bg-red-500 text-white animate-pulse' : 'bg-white text-gray-700 border-2 border-gray-200'}`}>
                                    {item}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // --- İYİLEŞTİRİLMİŞ SÜRÜKLE BIRAK OYUNU ---
        const DragDropGame = ({ question, onComplete }) => {
            const [selected, setSelected] = useState(null);
            const [isCorrect, setIsCorrect] = useState(false);
            const [error, setError] = useState(false);
            const [part1, part2] = question.q.split('_____');

            // Soru değiştiğinde sıfırla
            useEffect(() => {
                setSelected(null);
                setIsCorrect(false);
                setError(false);
            }, [question]);

            const handleSelect = (opt) => {
                if (opt === question.a) {
                    setSelected(opt);
                    setIsCorrect(true);
                    setTimeout(() => onComplete(true), 800);
                } else {
                    setError(true);
                    setTimeout(() => setError(false), 500);
                }
            };

            return (
                <div className="flex flex-col items-center justify-center p-6 bg-orange-50 rounded-2xl border-2 border-orange-200">
                    <div className="text-xl font-bold text-gray-700 mb-6 leading-loose bg-white p-6 rounded-2xl shadow-sm w-full text-center border-b-4 border-orange-100">
                        {part1}
                        <span className={`inline-flex items-center justify-center px-3 h-10 mx-1 border-b-4 rounded-lg font-bold transition-all align-middle text-lg 
                            ${isCorrect ? 'bg-green-100 border-green-500 text-green-700 scale-110' : 'bg-gray-100 border-gray-300 text-transparent min-w-[80px]'}`}>
                            {isCorrect ? selected : "?"}
                        </span>
                        {part2}
                    </div>
                    <div className="flex flex-wrap gap-3 justify-center w-full">
                        {question.o.map((opt, idx) => (
                            <button key={idx} onClick={() => handleSelect(opt)} disabled={isCorrect}
                                className={`flex-1 min-w-[100px] px-4 py-3 rounded-xl font-bold text-lg shadow-sm btn-touch border-b-4 no-tap-highlight
                                ${isCorrect && opt === selected ? 'bg-green-500 border-green-700 text-white' : error ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : 'bg-white border-orange-200 text-orange-600'}`}>
                                {opt}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        function App() {
            const [screen, setScreen] = useState('welcome');
            const [grade, setGrade] = useState(1);
            const [difficulty, setDifficulty] = useState('easy');
            const [levelData, setLevelData] = useState([]);
            const [qIndex, setQIndex] = useState(0);
            const [textIndex, setTextIndex] = useState(0);
            const [feedback, setFeedback] = useState(null);
            
            const [totalScore, setTotalScore] = useState(() => {
                const saved = localStorage.getItem('paragrafmatik_score');
                return saved ? parseInt(saved, 10) : 0;
            });

            useEffect(() => {
                localStorage.setItem('paragrafmatik_score', totalScore);
            }, [totalScore]);

            const startLevel = (g, d) => {
                const generatedStories = generateLevelContent(g, d, 20); 
                setGrade(g);
                setDifficulty(d);
                setLevelData(generatedStories);
                setTextIndex(0);
                setQIndex(0);
                setScore(0);
                setScreen('game');
            };

            const [score, setScore] = useState(0); // Level score

            const parseWords = (content) => {
                return content.split(' ').map((word, index) => {
                    const cleanText = word.toLowerCase().replace(/[.,'?!":;]/g, '');
                    return { text: word, cleanText, id: index };
                });
            };

            const handleAnswer = (isCorrect) => {
                if (isCorrect) {
                    setTotalScore(s => s + 10);
                    setScore(s => s + 10);
                    setFeedback('correct');
                    setTimeout(() => {
                        setFeedback(null);
                        // Eğer bir sonraki soru varsa oraya geç
                        if (qIndex < levelData[textIndex].questions.length - 1) {
                            setQIndex(prev => prev + 1);
                        } else {
                            // Sorular bitti, bir sonraki metne geç
                            if (textIndex < levelData.length - 1) {
                                setTextIndex(prev => prev + 1);
                                setQIndex(0);
                            } else {
                                // Her şey bitti, sonuç ekranı
                                setScreen('result');
                            }
                        }
                    }, 1000);
                } else {
                    setTotalScore(s => Math.max(0, s - 5));
                    setScore(s => Math.max(0, s - 5));
                    setFeedback('wrong');
                    setTimeout(() => setFeedback(null), 800);
                }
            };

            if (screen === 'welcome') return (
                <div className="min-h-screen bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 flex flex-col items-center justify-center p-4 relative overflow-hidden text-gray-800">
                    <div className="absolute top-10 left-10 text-white/20 animate-spin-slow text-6xl"><i className="fa-solid fa-star"></i></div>
                    <div className="absolute bottom-10 right-10 text-white/10 animate-spin-slow text-8xl"><i className="fa-solid fa-cloud"></i></div>
                    
                    <div className="bg-white/95 backdrop-blur-lg p-6 md:p-10 rounded-[2.5rem] shadow-2xl max-w-4xl w-full text-center z-10 border-8 border-white/20 transform">
                        <div className="absolute -top-6 right-6 bg-yellow-400 text-yellow-900 px-6 py-2 rounded-full font-black text-xl shadow-lg border-4 border-white animate-bounce">
                            <i className="fa-solid fa-trophy mr-2"></i> {totalScore} Puan
                        </div>

                        <div className="flex flex-col md:flex-row justify-center items-center gap-6 mb-8 mt-4">
                            <div className="bg-gradient-to-tr from-yellow-400 to-orange-500 p-6 rounded-full shadow-lg rotate-[-6deg] text-white text-5xl">
                                <i className="fa-solid fa-book-open"></i>
                            </div>
                            <div className="text-center md:text-left">
                                <h1 className="text-5xl md:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-pink-600 tracking-tighter">ALİHOCAM</h1>
                                <div className="text-lg font-bold text-gray-400 tracking-widest uppercase mt-2">Paragrafmatik V6.2</div>
                            </div>
                        </div>
                        
                        <div className="bg-indigo-50 py-3 px-8 rounded-full inline-block mb-8 border border-indigo-100">
                            <span className="text-lg font-bold text-indigo-600 flex items-center gap-2">
                                <i className="fa-solid fa-rocket text-pink-500"></i> Sonsuz Macera Modu
                            </span>
                        </div>

                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            {[1, 2, 3, 4].map((g) => (
                                <button key={g} onClick={() => { setGrade(g); setScreen('difficulty'); }}
                                    className={`group relative bg-white border-4 rounded-[2rem] p-4 transition-all btn-touch h-40 flex flex-col items-center justify-center no-tap-highlight shadow-sm 
                                    ${g === 1 ? 'border-green-100' : g === 2 ? 'border-blue-100' : g === 3 ? 'border-purple-100' : 'border-red-100'}`}>
                                    <div className={`text-6xl font-black mb-2 ${g === 1 ? 'text-green-400' : g === 2 ? 'text-blue-400' : g === 3 ? 'text-purple-400' : 'text-red-400'}`}>{g}</div>
                                    <div className="text-sm font-bold text-gray-400 uppercase tracking-widest">. Sınıf</div>
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );

            if (screen === 'difficulty') return (
                <div className="min-h-screen bg-indigo-50 flex flex-col p-4 md:p-8 justify-center items-center">
                    <div className="max-w-md w-full">
                        <div className="flex justify-between items-center mb-8">
                            <button onClick={() => setScreen('welcome')} className="bg-white p-4 rounded-2xl shadow text-gray-500 btn-touch transition-transform"><i className="fa-solid fa-house"></i></button>
                            <span className="text-3xl font-black text-indigo-900 bg-white px-6 py-2 rounded-full shadow-sm">{grade}. Sınıf</span>
                        </div>
                        
                        <div className="flex flex-col gap-4">
                            <button onClick={() => startLevel(grade, 'easy')} className="bg-white p-6 rounded-[2rem] shadow-lg border-l-8 border-green-400 btn-touch transition-transform flex items-center justify-between group no-tap-highlight">
                                <div>
                                    <div className="text-2xl font-black text-gray-800">Kolay</div>
                                    <div className="text-xs font-bold text-green-600 uppercase tracking-wider">20 Yeni Metin</div>
                                </div>
                                <div className="text-green-400 text-3xl"><i className="fa-solid fa-star"></i></div>
                            </button>

                            <button onClick={() => startLevel(grade, 'medium')} className="bg-white p-6 rounded-[2rem] shadow-lg border-l-8 border-blue-400 btn-touch transition-transform flex items-center justify-between group no-tap-highlight">
                                <div>
                                    <div className="text-2xl font-black text-gray-800">Orta</div>
                                    <div className="text-xs font-bold text-blue-600 uppercase tracking-wider">20 Yeni Metin</div>
                                </div>
                                <div className="text-blue-400 text-3xl"><i className="fa-solid fa-star-half-stroke"></i></div>
                            </button>

                            <button onClick={() => startLevel(grade, 'hard')} className="bg-white p-6 rounded-[2rem] shadow-lg border-l-8 border-red-400 btn-touch transition-transform flex items-center justify-between group no-tap-highlight">
                                <div>
                                    <div className="text-2xl font-black text-gray-800">Zor</div>
                                    <div className="text-xs font-bold text-red-600 uppercase tracking-wider">20 Yeni Metin</div>
                                </div>
                                <div className="text-red-400 text-3xl"><i className="fa-solid fa-medal"></i></div>
                            </button>
                        </div>
                    </div>
                </div>
            );

            if (screen === 'game') {
                const currentText = levelData[textIndex];
                const currentQuestion = currentText.questions[qIndex];
                const parsedWords = parseWords(currentText.content);
                const progress = ((textIndex) / levelData.length) * 100;

                return (
                    <div className="min-h-screen bg-gray-50 flex flex-col max-w-xl mx-auto shadow-2xl border-x border-gray-200">
                        <div className="bg-white p-4 shadow-sm z-20 flex justify-between items-center sticky top-0">
                            <button onClick={() => setScreen('difficulty')} className="bg-gray-100 p-3 rounded-xl text-gray-500 btn-touch transition-colors"><i className="fa-solid fa-arrow-left"></i></button>
                            <div className="text-center">
                                <div className="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1">HİKAYE {textIndex + 1} / {levelData.length}</div>
                                <h3 className="font-black text-gray-800 text-lg leading-none truncate w-40">{currentText.title}</h3>
                            </div>
                            <div className="bg-yellow-400 text-yellow-900 px-3 py-1 rounded-xl font-black text-lg shadow-sm flex items-center gap-2">
                                <i className="fa-solid fa-trophy"></i> {score}
                            </div>
                        </div>

                        <div className="w-full bg-gray-200 h-2"><div className="bg-green-500 h-2 transition-all duration-500" style={{width: `${progress}%`}}></div></div>

                        <div className="flex-1 overflow-y-auto p-5 pb-32 space-y-6">
                            <div className="bg-white rounded-[2rem] p-6 shadow-lg border-4 border-white ring-1 ring-gray-100 relative">
                                <div className="absolute -top-5 -right-5 bg-indigo-100 w-16 h-16 rounded-full flex items-center justify-center text-3xl shadow-md border-4 border-white text-indigo-500">
                                    <i className={`fa-solid ${currentText.icon}`}></i>
                                </div>
                                <div className="text-xl leading-[1.8] text-gray-700 font-medium pt-2 font-sans">
                                    {parsedWords.map((part, i) => (
                                        <TooltipWord key={i} displayWord={part.text} cleanWord={part.cleanText} />
                                    ))}
                                </div>
                                <div className="mt-4 pt-4 border-t-2 border-dashed border-gray-100 flex items-center justify-center gap-2 text-xs font-bold text-indigo-400">
                                    <i className="fa-solid fa-hand-pointer"></i> <span>Kelimelere dokun, anlamını öğren!</span>
                                </div>
                            </div>

                            <div className="bg-white rounded-[2rem] p-6 shadow-lg border-4 border-white ring-1 ring-gray-100 relative min-h-[300px]">
                                {feedback && (
                                    <div className="absolute inset-0 z-50 flex flex-col items-center justify-center rounded-[2rem] bg-white/95 backdrop-blur-sm animate-in fade-in zoom-in duration-300">
                                        <div className={`text-6xl mb-2 ${feedback === 'correct' ? 'text-green-500' : 'text-red-500'}`}>
                                            <i className={`fa-solid ${feedback === 'correct' ? 'fa-circle-check' : 'fa-circle-xmark'}`}></i>
                                        </div>
                                        <span className={`font-black text-3xl uppercase tracking-widest ${feedback === 'correct' ? 'text-green-600' : 'text-red-600'}`}>
                                            {feedback === 'correct' ? 'Harika! +10' : 'Hatalı! -5'}
                                        </span>
                                    </div>
                                )}

                                <div className="mb-6 flex justify-between items-center">
                                    <span className={`px-3 py-1 rounded-lg text-xs font-black uppercase tracking-wider text-white shadow
                                        ${currentQuestion.t === 'mc' ? 'bg-blue-500' : currentQuestion.t === 'dnd' ? 'bg-orange-500' : 'bg-purple-500'}`}>
                                        {currentQuestion.t === 'mc' ? 'Test' : currentQuestion.t === 'dnd' ? 'Boşluk' : 'Eşleştirme'}
                                    </span>
                                    <span className="text-gray-200 font-black text-4xl">{qIndex + 1}</span>
                                </div>

                                {currentQuestion.t !== 'match' && <h3 className="text-xl font-bold text-gray-800 mb-6 text-center">{currentQuestion.q}</h3>}

                                {currentQuestion.t === 'mc' && (
                                    <div className="space-y-3">
                                        {currentQuestion.o.map((opt, i) => (
                                            <button key={i} onClick={() => handleAnswer(opt === currentQuestion.a)} 
                                                className="w-full p-4 rounded-xl border-2 border-gray-100 bg-white active:bg-indigo-50 active:border-indigo-300 text-left text-lg font-bold text-gray-700 flex items-center gap-4 transition-colors shadow-sm group no-tap-highlight btn-touch">
                                                <span className="w-8 h-8 rounded-lg bg-gray-100 border border-gray-200 text-gray-400 flex items-center justify-center text-sm font-black">
                                                    {String.fromCharCode(65 + i)}
                                                </span>
                                                {opt}
                                            </button>
                                        ))}
                                    </div>
                                )}
                                {currentQuestion.t === 'match' && <MatchGame key={`match-${textIndex}-${qIndex}`} question={currentQuestion} onComplete={() => handleAnswer(true)} />}
                                {currentQuestion.t === 'dnd' && <DragDropGame key={`dnd-${textIndex}-${qIndex}`} question={currentQuestion} onComplete={() => handleAnswer(true)} />}
                            </div>
                        </div>
                    </div>
                );
            }

            if (screen === 'result') return (
                <div className="min-h-screen bg-indigo-600 flex items-center justify-center p-6 relative overflow-hidden">
                    <div className="absolute inset-0 pointer-events-none opacity-20">
                        <i className="fa-solid fa-star absolute top-10 left-10 text-yellow-400 text-4xl animate-spin-slow"></i>
                    </div>

                    <div className="bg-white rounded-[3rem] p-10 w-full max-w-sm text-center shadow-2xl relative">
                        <div className="absolute -top-12 left-1/2 -translate-x-1/2 bg-yellow-400 p-6 rounded-full border-8 border-indigo-600 shadow-xl text-white text-5xl">
                            <i className="fa-solid fa-crown"></i>
                        </div>
                        
                        <div className="mt-12 mb-6">
                            <h2 className="text-4xl font-black text-gray-800 mb-2">Tebrikler!</h2>
                            <p className="text-gray-500 font-bold">20 Metni Başarıyla Tamamladın.</p>
                        </div>
                        
                        <div className="bg-gray-50 rounded-3xl p-6 mb-8 border-2 border-gray-100">
                            <div className="text-xs text-gray-400 uppercase font-black tracking-widest mb-1">BU BÖLÜM PUANI</div>
                            <div className="text-6xl font-black text-indigo-600 tracking-tighter">{score}</div>
                        </div>

                        <button onClick={() => setScreen('difficulty')} className="w-full bg-indigo-600 text-white font-black py-4 rounded-xl shadow-lg active:scale-95 transition-transform mb-3 text-lg flex items-center justify-center gap-2 no-tap-highlight">
                            <i className="fa-solid fa-arrow-right"></i> Devam Et
                        </button>
                        <button onClick={() => setScreen('welcome')} className="w-full bg-white text-gray-400 font-bold py-4 rounded-xl border-2 border-gray-100 active:bg-gray-50 transition-colors no-tap-highlight">
                            Çıkış
                        </button>
                    </div>
                </div>
            );

            return null;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
