<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AliHocam Problemmatik</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Roboto:wght@400;500;700&display=swap');

        :root {
            --primary: #d35400; 
            --secondary: #e67e22;
            --bg: #f3f4f6;
            --dark-overlay: #2d3748;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        /* --- 1. AYARLAR PANELÄ° (GÄ°RÄ°Å EKRANI) --- */
        #settings-panel {
            max-width: 800px;
            margin: 40px auto;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .brand-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
            padding-bottom: 20px;
        }

        .brand-title {
            font-family: 'Patrick Hand', cursive;
            font-size: 3rem;
            color: var(--primary);
            margin: 0;
        }

        .brand-subtitle {
            color: #666;
            font-size: 1.1rem;
            letter-spacing: 1px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            font-weight: 700;
            margin-bottom: 8px;
            color: #2d3748;
        }

        select, input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }

        select:focus, input:focus {
            border-color: var(--primary);
            outline: none;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #fff7ed;
            border: 1px solid #ffedd5;
            border-radius: 8px;
            cursor: pointer;
        }

        .btn-large {
            grid-column: 1 / -1;
            background-color: var(--primary);
            color: white;
            padding: 18px;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, background 0.3s;
            margin-top: 10px;
            box-shadow: 0 4px 6px rgba(211, 84, 0, 0.3);
        }

        .btn-large:hover {
            background-color: var(--secondary);
            transform: translateY(-2px);
        }

        /* --- 2. Ã–NÄ°ZLEME MODU (FULL SCREEN OVERLAY) --- */
        #preview-modal {
            display: none; /* BaÅŸlangÄ±Ã§ta gizli */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--dark-overlay);
            z-index: 1000;
            overflow-y: auto;
            padding-top: 80px; /* Toolbar iÃ§in boÅŸluk */
            padding-bottom: 40px;
        }

        /* Toolbar (Ãœstteki butonlar) */
        .preview-toolbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: #1a202c;
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: 1001;
        }

        .btn-tool {
            padding: 10px 25px;
            border-radius: 6px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }

        .btn-back { background: #4a5568; color: white; }
        .btn-back:hover { background: #2d3748; }

        .btn-print { background: #48bb78; color: white; }
        .btn-print:hover { background: #38a169; }

        /* Konteyner: SayfalarÄ± alt alta tutar */
        #pages-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px; /* Sayfalar arasÄ± boÅŸluk */
            padding-bottom: 50px;
        }

        /* Sayfa Etiketi (Ã–nizlemede gÃ¶rÃ¼nÃ¼r, baskÄ±da gizlenir) */
        .page-label {
            color: #fff;
            font-weight: bold;
            margin-bottom: -30px; /* SayfanÄ±n hemen Ã¼stÃ¼ne yapÄ±ÅŸÄ±k */
            z-index: 10;
            background: #000;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
        }

        /* A4 KaÄŸÄ±t GÃ¶rÃ¼nÃ¼mÃ¼ */
        .a4-page {
            width: 210mm;
            min-height: 297mm; /* A4 YÃ¼ksekliÄŸi */
            background: white;
            padding: 20mm; /* Standart kenar boÅŸluÄŸu */
            box-shadow: 0 0 25px rgba(0,0,0,0.5);
            box-sizing: border-box;
            position: relative;
            page-break-after: always; /* BaskÄ±da her div'den sonra sayfa atla */
        }

        /* --- KAÄIT Ä°Ã‡ERÄ°ÄÄ° STÄ°LLERÄ° --- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #000;
            padding-bottom: 15px;
            margin-bottom: 30px;
        }

        .logo-area {
            font-family: 'Patrick Hand', cursive;
            font-size: 1.8rem;
            font-weight: bold;
            color: #000;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            background: var(--primary);
            color: #fff;
            width: 50px;
            height: 50px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            transform: rotate(-5deg);
        }

        .student-info {
            text-align: right;
            font-size: 1.1rem;
            line-height: 1.8;
            font-family: 'Patrick Hand', cursive;
            color: #000;
        }

        .student-info span {
            display: inline-block;
            border-bottom: 1px dotted #000;
            width: 150px;
        }

        .problem-list {
            display: flex;
            flex-direction: column;
            gap: 35px; /* Sorular arasÄ± boÅŸluk */
        }

        .problem-item {
            font-family: 'Roboto', sans-serif;
            font-size: 1.2rem;
            line-height: 1.5;
            page-break-inside: avoid; /* Sorunun ortadan bÃ¶lÃ¼nmesini engelle */
            color: #000;
        }

        .problem-text {
            margin-bottom: 15px;
            display: block;
        }

        .problem-number {
            font-weight: bold;
            color: var(--primary);
            margin-right: 8px;
            font-size: 1.3rem;
        }

        .work-area {
            width: 100%;
            height: 140px;
            border: 2px solid #cbd5e0;
            border-radius: 8px;
            position: relative;
            background-color: #fff;
        }

        .work-area-label {
            position: absolute;
            top: 8px;
            left: 12px;
            font-size: 0.8rem;
            color: #a0aec0;
            font-style: italic;
        }

        .answer-line {
            position: absolute;
            bottom: 15px;
            right: 25px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        /* --- BASKI AYARLARI (CRITICAL) --- */
        @media print {
            @page {
                size: A4;
                margin: 0; /* TarayÄ±cÄ± marjlarÄ±nÄ± sÄ±fÄ±rla, biz iÃ§eriden veriyoruz */
            }
            body {
                background: white;
            }
            /* ArayÃ¼z elemanlarÄ±nÄ± gizle */
            #settings-panel, .preview-toolbar, .page-label {
                display: none !important;
            }
            /* Modal yapÄ±sÄ±nÄ± kaldÄ±r */
            #preview-modal {
                position: static;
                display: block !important;
                background: white;
                width: 100%;
                height: auto;
                padding: 0;
                overflow: visible;
            }
            /* Konteyner dÃ¼zenini sÄ±fÄ±rla */
            #pages-container {
                display: block;
                gap: 0;
                padding: 0;
            }
            /* KaÄŸÄ±t stilini baskÄ±ya uyarla */
            .a4-page {
                box-shadow: none;
                margin: 0;
                width: 100%;
                border: none;
                page-break-after: always; /* Her sayfa sonrasÄ± kes */
            }
            .a4-page:last-child {
                page-break-after: auto; /* Son sayfadan sonra boÅŸ sayfa Ã§Ä±karma */
            }
            .work-area {
                border-color: #000; /* BaskÄ±da net Ã§izgi */
            }
        }
    </style>
</head>
<body>

    <!-- 1. AYAR PANELÄ° -->
    <div id="settings-panel">
        <div class="brand-header">
            <h1 class="brand-title">AliHocam Problemmatik</h1>
            <div class="brand-subtitle">Hikayeli Matematik OluÅŸturucu</div>
        </div>

        <div class="settings-grid">
            <div class="control-group">
                <label>Ä°ÅŸlem TÃ¼rÃ¼</label>
                <select id="operation" onchange="updateOptions()">
                    <option value="toplama">Toplama Problemleri (+)</option>
                    <option value="cikarma">Ã‡Ä±karma Problemleri (-)</option>
                    <option value="carpma">Ã‡arpma Problemleri (x)</option>
                    <option value="bolme">BÃ¶lme Problemleri (Ã·)</option>
                </select>
            </div>

            <div class="control-group">
                <label>Toplam Soru SayÄ±sÄ±</label>
                <input type="number" id="questionCount" value="10" min="1" max="50">
                <small style="color:#666; font-size:0.8rem">Sistem her 5 soruda bir otomatik yeni sayfa oluÅŸturur.</small>
            </div>

            <div class="control-group">
                <label>1. SayÄ± BasamaÄŸÄ±</label>
                <input type="number" id="digit1" value="2" min="1" max="4">
            </div>

            <div class="control-group">
                <label>2. SayÄ± BasamaÄŸÄ±</label>
                <input type="number" id="digit2" value="1" min="1" max="4">
            </div>

            <div class="control-group" style="grid-column: 1 / -1;">
                <label>Ã–zel Kurallar</label>
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="advancedRule" checked> 
                    <span id="advancedRuleText">Eldesiz Olsun (Daha Basit)</span>
                </label>
            </div>

            <button class="btn-large" onclick="showPreview()">
                âœ¨ TaslaÄŸÄ± HazÄ±rla ve Ã–nizle
            </button>
        </div>
    </div>

    <!-- 2. Ã–NÄ°ZLEME ALANI (BAÅLANGIÃ‡TA GÄ°ZLÄ°) -->
    <div id="preview-modal">
        <div class="preview-toolbar">
            <button class="btn-tool btn-back" onclick="closePreview()">
                â¬…ï¸ DÃ¼zenlemeye DÃ¶n
            </button>
            <button class="btn-tool btn-print" onclick="window.print()">
                ğŸ–¨ï¸ YazdÄ±r
            </button>
        </div>

        <div id="pages-container">
            <!-- Sayfalar buraya JS ile eklenecek -->
        </div>
    </div>

    <script>
        // Ä°sim Havuzu
        const names = ["Ali", "AyÅŸe", "Mehmet", "Zeynep", "Can", "Elif", "Kerem", "Defne", "Mustafa", "Fatma", "Ã–mer", "Zehra", "Efe", "Mina"];

        // Kategorize EdilmiÅŸ Nesneler
        const categories = {
            toy: ["bilye", "balon", "oyuncak araba", "lego parÃ§asÄ±", "toka", "kart"],
            market: ["yumurta", "ekmek", "Ã§ikolata", "dondurma", "poÄŸaÃ§a", "ÅŸiÅŸe su"],
            grocery: ["elma", "armut", "portakal", "kivi", "nar"], 
            stationary: ["kalem", "silgi", "defter", "boya kalemi", "aÃ§acak", "roman"],
            nuts: ["ceviz", "fÄ±ndÄ±k", "fÄ±stÄ±k", "kestane"]
        };

        const templates = {
            toplama: [
                { text: "{name}, {n1} tane {obj} topladÄ±. ArkadaÅŸÄ± da ona {n2} tane {obj} verdi. {name}'nin toplam kaÃ§ {obj}i oldu?", cat: "nuts" },
                { text: "{name}'nin {n1} tane {obj}sÄ± vardÄ±. DoÄŸum gÃ¼nÃ¼nde {n2} tane daha {obj} hediye edildi. Toplam kaÃ§ tane {obj}sÄ± oldu?", cat: "toy" },
                { text: "Bir markette sabah {n1} tane {obj} satÄ±ldÄ±. Ã–ÄŸleden sonra {n2} tane daha {obj} satÄ±ldÄ±. GÃ¼n boyu toplam kaÃ§ tane {obj} satÄ±lmÄ±ÅŸtÄ±r?", cat: "market" },
                { text: "{name} kitabÄ±nÄ±n Ã¶nce {n1} sayfasÄ±nÄ±, sonra {n2} sayfasÄ±nÄ± okudu. {name} toplam kaÃ§ sayfa kitap okumuÅŸtur?", cat: "none" },
                { text: "Kumbaramda {n1} lira vardÄ±. Babam {n2} lira daha harÃ§lÄ±k verdi. Kumbaramda toplam kaÃ§ liram oldu?", cat: "none" }
            ],
            cikarma: [
                { text: "{name}'nin {n1} tane {obj}i vardÄ±. BunlarÄ±n {n2} tanesini kaybetti. Geriye kaÃ§ tane {obj}i kaldÄ±?", cat: "toy" },
                { text: "Bir tabakta {n1} tane {obj} vardÄ±. {name} bunlarÄ±n {n2} tanesini yedi. Tabakta kaÃ§ tane {obj} kaldÄ±?", cat: "nuts" },
                { text: "KÄ±rtasiyedeki {n1} tane {obj}in {n2} tanesi satÄ±ldÄ±. Geriye kaÃ§ tane {obj} kaldÄ±?", cat: "stationary" },
                { text: "OtobÃ¼ste {n1} yolcu vardÄ±. Durakta {n2} yolcu indi. OtobÃ¼ste kaÃ§ yolcu kaldÄ±?", cat: "none" },
                { text: "{n1} sayfalÄ±k bir kitabÄ±n {n2} sayfasÄ±nÄ± okuyan {name}'nin okumadÄ±ÄŸÄ± kaÃ§ sayfasÄ± kalmÄ±ÅŸtÄ±r?", cat: "none" }
            ],
            carpma: [
                { text: "Tanesi {n2} lira olan {obj}lerden {n1} tane alan {name}, satÄ±cÄ±ya kaÃ§ lira Ã¶der?", cat: "market" },
                { text: "Bir sÄ±nÄ±fta {n1} tane sÄ±ra vardÄ±r. Her sÄ±rada {n2} Ã¶ÄŸrenci oturduÄŸuna gÃ¶re sÄ±nÄ±f mevcudu kaÃ§tÄ±r?", cat: "none" },
                { text: "Her gÃ¼n {n2} sayfa kitap okuyan {name}, {n1} gÃ¼nde toplam kaÃ§ sayfa okur?", cat: "none" },
                { text: "Bir kutuda {n2} tane {obj} vardÄ±r. {n1} kutuda toplam kaÃ§ tane {obj} olur?", cat: "toy" }
            ],
            bolme: [
                { text: "{n1} tane {obj}, {n2} tabaÄŸa eÅŸit olarak paylaÅŸtÄ±rÄ±lÄ±yor. Her tabaÄŸa kaÃ§ tane {obj} dÃ¼ÅŸer?", cat: "nuts" },
                { text: "{n1} tane {obj}i {n2} arkadaÅŸ eÅŸit olarak paylaÅŸÄ±rsa her birine kaÃ§ tane {obj} dÃ¼ÅŸer?", cat: "toy" },
                { text: "{n1} sayfalÄ±k kitabÄ± her gÃ¼n {n2} sayfa okuyarak bitirmek isteyen {name}, kitabÄ± kaÃ§ gÃ¼nde bitirir?", cat: "none" },
                { text: "{n1} lira parayÄ± {n2} Ã§ocuÄŸa eÅŸit paylaÅŸtÄ±rÄ±rsak her Ã§ocuÄŸa kaÃ§ lira dÃ¼ÅŸer?", cat: "none" }
            ]
        };

        function rand(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
        function getRandomItem(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
        function randByDigit(digits) {
            const min = Math.pow(10, digits - 1);
            const max = Math.pow(10, digits) - 1;
            return rand(min, max);
        }

        // --- ARAYÃœZ KONTROLLERÄ° ---
        function updateOptions() {
            const op = document.getElementById('operation').value;
            const textSpan = document.getElementById('advancedRuleText');
            const checkbox = document.getElementById('advancedRule');

            if (op === 'toplama') {
                textSpan.innerText = "Eldesiz Olsun (Basit)";
                checkbox.disabled = false;
            } else if (op === 'cikarma') {
                textSpan.innerText = "Onluk Bozmadan (Basit)";
                checkbox.disabled = false;
            } else {
                textSpan.innerText = "Standart Rastgele";
                checkbox.disabled = true;
                checkbox.checked = false;
            }
        }

        function showPreview() {
            generateProblems();
            document.getElementById('settings-panel').style.display = 'none';
            document.getElementById('preview-modal').style.display = 'block';
            window.scrollTo(0, 0);
        }

        function closePreview() {
            document.getElementById('preview-modal').style.display = 'none';
            document.getElementById('settings-panel').style.display = 'block';
        }

        // --- SAYFA OLUÅTURUCU (HTML) ---
        function createPageHTML(pageIndex) {
            const pageDiv = document.createElement('div');
            pageDiv.className = 'a4-page';
            pageDiv.innerHTML = `
                <div class="header">
                    <div class="logo-area">
                        <div class="logo-icon">A</div>
                        <div>
                            AliHocam<br>
                            <span style="font-size:0.5em; letter-spacing: 2px;">PROBLEMMATÄ°K</span>
                        </div>
                    </div>
                    <div class="student-info">
                        AdÄ± SoyadÄ±: <span></span><br>
                        SÄ±nÄ±fÄ±: <span></span><br>
                        Tarih: <span></span>
                    </div>
                </div>
                <div style="text-align:center; margin-bottom:30px; font-weight:bold; text-decoration:underline; font-size:1.4rem;">
                    MATEMATÄ°K PROBLEMLERÄ°
                </div>
                <div class="problem-list" id="problem-list-${pageIndex}"></div>
            `;
            return pageDiv;
        }

        // --- MANTIK MOTORU ---
        function generateNumbers(op, isSimple, d1, d2) {
            let n1, n2;

            if (op === 'toplama') {
                if (isSimple) {
                    let result1 = 0, result2 = 0, multiplier = 1;
                    for(let i=0; i<Math.max(d1,d2); i++) {
                        let canHave1 = i < d1;
                        let canHave2 = i < d2;
                        let min1 = (i === d1 - 1) ? 1 : 0;
                        let min2 = (i === d2 - 1) ? 1 : 0;
                        let val1 = canHave1 ? rand(min1, 9) : 0;
                        let maxVal2 = 9 - val1;
                        if(maxVal2 < min2) { val1 = 9 - min2; maxVal2 = min2; }
                        let val2 = canHave2 ? rand(min2, maxVal2) : 0;
                        result1 += val1 * multiplier;
                        result2 += val2 * multiplier;
                        multiplier *= 10;
                    }
                    n1 = result1; n2 = result2;
                } else {
                    n1 = randByDigit(d1);
                    n2 = randByDigit(d2);
                }
            } 
            else if (op === 'cikarma') {
                if (isSimple) {
                    let result1 = 0, result2 = 0, multiplier = 1;
                    for(let i=0; i<d1; i++) {
                        let min1 = (i === d1 - 1) ? 1 : 0;
                        let val1 = rand(min1, 9);
                        let val2 = 0;
                        if (i < d2) {
                            let min2 = (i === d2 - 1) ? 1 : 0;
                            if (val1 < min2) val1 = min2;
                            val2 = rand(min2, val1);
                        }
                        result1 += val1 * multiplier;
                        result2 += val2 * multiplier;
                        multiplier *= 10;
                    }
                    n1 = result1; n2 = result2;
                } else {
                    n1 = randByDigit(d1);
                    let maxN2 = Math.pow(10, d2) - 1;
                    let minN2 = Math.pow(10, d2 - 1);
                    if(n1 < minN2) n1 = rand(minN2 + 1, Math.pow(10, d1) - 1);
                    let reelMax = Math.min(n1 - 1, maxN2);
                    n2 = rand(minN2, reelMax);
                }
            }
            else if (op === 'carpma') {
                n1 = randByDigit(d1);
                n2 = randByDigit(d2);
            }
            else if (op === 'bolme') {
                let divisor = randByDigit(d2);
                let quotient = randByDigit(Math.max(1, d1 - d2 + 1));
                if (d1 === 1) quotient = rand(1, 9);
                n2 = divisor;
                n1 = divisor * quotient;
            }
            return [n1, n2];
        }

        function generateProblems() {
            const op = document.getElementById('operation').value;
            const isSimple = document.getElementById('advancedRule').checked;
            const d1 = parseInt(document.getElementById('digit1').value);
            const d2 = parseInt(document.getElementById('digit2').value);
            const count = parseInt(document.getElementById('questionCount').value);
            const container = document.getElementById('pages-container');
            
            container.innerHTML = "";

            // Sayfalama ayarÄ± (Her sayfada 5 soru)
            const questionsPerPage = 5;
            let currentPageIndex = 0;
            let currentListElement = null;

            for (let k = 1; k <= count; k++) {
                // Yeni sayfa gerekiyor mu?
                if ((k - 1) % questionsPerPage === 0) {
                    currentPageIndex++;
                    
                    // GÃ¶rsel etiket (Sayfa 1, Sayfa 2...)
                    const label = document.createElement('div');
                    label.className = 'page-label';
                    label.innerText = 'Sayfa ' + currentPageIndex;
                    container.appendChild(label);

                    // A4 Sayfa
                    const page = createPageHTML(currentPageIndex);
                    container.appendChild(page);
                    
                    // SorularÄ±n ekleneceÄŸi listeyi seÃ§
                    currentListElement = page.querySelector(`#problem-list-${currentPageIndex}`);
                }

                // Soru Ãœretimi
                let [n1, n2] = generateNumbers(op, isSimple, d1, d2);
                const name = getRandomItem(names);
                
                let templateObj = getRandomItem(templates[op]);
                let problemText = templateObj.text;
                
                if (templateObj.cat !== "none") {
                    const selectedList = categories[templateObj.cat];
                    const obj = getRandomItem(selectedList);
                    problemText = problemText.replace(/{obj}/g, obj);
                }

                problemText = problemText
                    .replace(/{name}/g, name)
                    .replace(/{n1}/g, n1)
                    .replace(/{n2}/g, n2);

                const div = document.createElement('div');
                div.className = 'problem-item';
                div.innerHTML = `
                    <div class="problem-text">
                        <span class="problem-number">${k})</span>
                        ${problemText}
                    </div>
                    <div class="work-area">
                        <span class="work-area-label">Ä°ÅŸlem AlanÄ±</span>
                        <div class="answer-line">Cevap: _______________</div>
                    </div>
                `;
                currentListElement.appendChild(div);
            }
        }
    </script>
</body>
</html>